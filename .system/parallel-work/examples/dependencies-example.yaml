# Story Dependencies Example
# This example shows dependency graphs and parallel work strategies for Epic 1: User Management
# Demonstrates how orc-exe analyzes dependencies and recommends parallel execution

epic_id: "1-user-management"
epic_title: "User Management System"
total_stories: 6
analysis_timestamp: "2025-01-15T09:00:00Z"
phase: "first_pass"

# Story inventory with dependency metadata
stories:
  - story_id: "1-1-user-authentication"
    title: "User Authentication with JWT"
    status: "TODO"
    estimated_effort: "2 hours"
    depends_on: []  # No dependencies - can start immediately
    blocks: ["1-4-role-based-access-control"]  # RBAC needs auth first
    shared_resources:
      - "database_schema:users_table"
      - "config:jwt_secret"
    conflict_zones:
      - "database_schema"

  - story_id: "1-2-user-profile-management"
    title: "User Profile CRUD Operations"
    status: "TODO"
    estimated_effort: "1.5 hours"
    depends_on: ["1-1-user-authentication"]  # Needs user table from auth
    blocks: []
    shared_resources:
      - "database_schema:users_table"
      - "api_endpoints:user_routes"
    conflict_zones:
      - "database_schema"

  - story_id: "1-3-password-reset-flow"
    title: "Password Reset via Email"
    status: "TODO"
    estimated_effort: "2 hours"
    depends_on: []  # Independent - can run in parallel with 1-1
    blocks: []
    shared_resources:
      - "services:email_service"
      - "database_schema:reset_tokens_table"
    conflict_zones:
      - "email_configuration"

  - story_id: "1-4-role-based-access-control"
    title: "RBAC System Implementation"
    status: "TODO"
    estimated_effort: "3 hours"
    depends_on: ["1-1-user-authentication"]  # Needs auth context
    blocks: ["1-5-admin-dashboard"]  # Dashboard needs RBAC
    shared_resources:
      - "database_schema:roles_table"
      - "middleware:authorization"
    conflict_zones:
      - "database_schema"
      - "middleware_chain"

  - story_id: "1-5-admin-dashboard"
    title: "Admin User Management Dashboard"
    status: "TODO"
    estimated_effort: "2.5 hours"
    depends_on: ["1-4-role-based-access-control", "1-2-user-profile-management"]
    blocks: []
    shared_resources:
      - "frontend:admin_routes"
      - "api_endpoints:admin_api"
    conflict_zones:
      - "frontend_routing"

  - story_id: "1-6-audit-logging"
    title: "User Action Audit Logging"
    status: "TODO"
    estimated_effort: "1 hour"
    depends_on: []  # Independent - logging can be developed in parallel
    blocks: []
    shared_resources:
      - "database_schema:audit_logs_table"
      - "middleware:logging_middleware"
    conflict_zones:
      - "database_schema"

# Dependency graph visualization
dependency_graph:
  # Format: "story_id -> [dependent_stories]"
  graph:
    "1-1-user-authentication": ["1-2-user-profile-management", "1-4-role-based-access-control"]
    "1-2-user-profile-management": ["1-5-admin-dashboard"]
    "1-3-password-reset-flow": []
    "1-4-role-based-access-control": ["1-5-admin-dashboard"]
    "1-5-admin-dashboard": []
    "1-6-audit-logging": []

  # Critical path (longest dependency chain)
  critical_path:
    - "1-1-user-authentication"
    - "1-4-role-based-access-control"
    - "1-5-admin-dashboard"
  critical_path_duration: "7.5 hours"

  # Independent clusters (can run fully in parallel)
  independent_clusters:
    - cluster_id: "cluster_1"
      stories: ["1-1-user-authentication", "1-3-password-reset-flow", "1-6-audit-logging"]
      max_parallelism: 3
      estimated_duration: "2 hours"  # Limited by longest story (1-1 or 1-3)

# Parallel work strategies analyzed by orc-exe
strategies:
  # Strategy 1: Maximum Parallelism (High Risk)
  - strategy_id: "strategy_1_max_parallel"
    name: "Maximum Parallelism - 3 Terminals"
    description: "Start all independent stories immediately"
    parallelism_level: "high"
    risk_level: "medium"

    execution_plan:
      wave_1:
        terminals: 3
        stories: ["1-1-user-authentication", "1-3-password-reset-flow", "1-6-audit-logging"]
        duration: "2 hours"
        conflicts:
          - "Database schema coordination needed between 1-1 and 1-6"

      wave_2:
        terminals: 2
        stories: ["1-2-user-profile-management", "1-4-role-based-access-control"]
        duration: "3 hours"
        conflicts:
          - "Both extend users table schema from 1-1"

      wave_3:
        terminals: 1
        stories: ["1-5-admin-dashboard"]
        duration: "2.5 hours"
        conflicts: []

    total_duration: "7.5 hours"
    speedup: "2x"  # vs 16 hours sequential
    coordination_overhead: "30 minutes"
    recommended: false
    reason: "High coordination overhead for first-pass development"

  # Strategy 2: Balanced Approach (Recommended)
  - strategy_id: "strategy_2_balanced"
    name: "Balanced Parallelism - 2 Terminals"
    description: "Parallel independent stories, sequential for dependencies"
    parallelism_level: "medium"
    risk_level: "low"

    execution_plan:
      wave_1:
        terminals: 2
        stories: ["1-1-user-authentication", "1-3-password-reset-flow"]
        duration: "2 hours"
        conflicts: []  # No conflicts - truly independent

      wave_2:
        terminals: 2
        stories: ["1-2-user-profile-management", "1-6-audit-logging"]
        duration: "1.5 hours"
        conflicts:
          - "Both access users table, but 1-6 only reads metadata"

      wave_3:
        terminals: 1
        stories: ["1-4-role-based-access-control"]
        duration: "3 hours"
        conflicts: []

      wave_4:
        terminals: 1
        stories: ["1-5-admin-dashboard"]
        duration: "2.5 hours"
        conflicts: []

    total_duration: "9 hours"
    speedup: "1.8x"  # vs 16 hours sequential
    coordination_overhead: "15 minutes"
    recommended: true
    reason: "Best balance of speed and coordination for first-pass"

  # Strategy 3: Conservative Sequential
  - strategy_id: "strategy_3_sequential"
    name: "Sequential with Dependency Respect"
    description: "One story at a time, strict dependency ordering"
    parallelism_level: "none"
    risk_level: "none"

    execution_plan:
      sequence:
        - "1-1-user-authentication"  # 2h
        - "1-3-password-reset-flow"  # 2h
        - "1-6-audit-logging"        # 1h
        - "1-2-user-profile-management"  # 1.5h
        - "1-4-role-based-access-control"  # 3h
        - "1-5-admin-dashboard"      # 2.5h

    total_duration: "12 hours"
    speedup: "1.3x"  # vs 16 hours (some optimization from ordering)
    coordination_overhead: "0 minutes"
    recommended: false
    reason: "Only use if operator unfamiliar with parallel work"

# Conflict detection and resolution
conflicts:
  - conflict_id: "conflict_1"
    type: "database_schema"
    affected_stories: ["1-1-user-authentication", "1-2-user-profile-management", "1-6-audit-logging"]
    description: "All three stories modify or extend users table"
    severity: "medium"

    resolution_options:
      - option: "sequential_schema"
        description: "1-1 creates base table, 1-2 extends, 1-6 reads"
        effort: "low"
        recommended: true

      - option: "coordinated_parallel"
        description: "1-1 and 1-6 coordinate schema in real-time"
        effort: "medium"
        recommended: false

  - conflict_id: "conflict_2"
    type: "shared_middleware"
    affected_stories: ["1-4-role-based-access-control", "1-6-audit-logging"]
    description: "Both add middleware to request chain"
    severity: "low"

    resolution_options:
      - option: "merge_at_integration"
        description: "Develop independently, test middleware chain at merge point"
        effort: "low"
        recommended: true

# Active session tracking (populated during execution)
active_sessions:
  - session_id: "session_2025-01-15_093012"
    strategy_used: "strategy_2_balanced"
    current_wave: "wave_1"
    terminals_active: 2
    stories_in_progress: ["1-1-user-authentication", "1-3-password-reset-flow"]

# Recommendations from orc-exe
recommendations:
  primary: "Use strategy_2_balanced for optimal first-pass development"

  rationale:
    - "2 independent stories in wave 1 provide immediate parallelism"
    - "Low coordination overhead suitable for first-pass focus"
    - "Database schema conflicts resolved naturally by wave sequencing"
    - "Critical path (1-1 -> 1-4 -> 1-5) preserved"

  operator_guidance:
    - "Start with T1=1-1 and T2=1-3 simultaneously"
    - "Monitor 1-1 completion to unblock 1-2 and 1-4"
    - "1-6 can run anytime after 1-1 completes users table"
    - "Reserve 15 minutes for merge point coordination"

  autonomous_mode_notes:
    - "If MCP contract validation available, consider strategy_1 for wave_1"
    - "Real-time conflict detection could enable more aggressive parallelism"
    - "Second-pass can use higher parallelism with established patterns"

# Metrics for tracking
metrics:
  total_effort_sequential: "16 hours"
  total_effort_optimal_parallel: "9 hours"
  theoretical_max_speedup: "3x"  # With 3 terminals
  recommended_speedup: "1.8x"  # Strategy 2
  coordination_risk_score: "2/10"  # Low risk for strategy 2
