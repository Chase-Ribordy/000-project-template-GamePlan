<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Example Button - Sandbox Test</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }

    .sandbox-container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 20px;
    }

    .sandbox-header {
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
      margin-bottom: 20px;
    }

    .sandbox-title {
      font-size: 24px;
      font-weight: 600;
      color: #333;
    }

    .sandbox-subtitle {
      margin-top: 5px;
      font-size: 14px;
      color: #666;
    }

    .sandbox-status {
      margin-top: 5px;
      font-size: 14px;
      color: #666;
      font-weight: 600;
    }

    #component-mount {
      min-height: 200px;
      border: 2px dashed #ddd;
      border-radius: 4px;
      padding: 40px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      align-items: flex-start;
    }

    .test-controls {
      margin-top: 20px;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 4px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .test-controls button {
      padding: 8px 16px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: white;
      cursor: pointer;
      font-size: 14px;
    }

    .test-controls button:hover {
      background: #f5f5f5;
    }

    .test-log {
      margin-top: 20px;
      padding: 15px;
      background: #1e1e1e;
      color: #d4d4d4;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
    }

    .test-log-entry {
      padding: 4px 0;
      border-bottom: 1px solid #333;
    }

    .test-log-entry:last-child {
      border-bottom: none;
    }

    .test-log-time {
      color: #858585;
    }

    .test-log-success {
      color: #4ec9b0;
    }

    .test-log-error {
      color: #f48771;
    }

    .test-log-info {
      color: #d4d4d4;
    }

    /* Component styles */
    .component-example-button {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-family: system-ui, -apple-system, sans-serif;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .component-example-button:hover:not(.component-example-button--disabled) {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }

    .component-example-button:active:not(.component-example-button--disabled) {
      transform: translateY(0);
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    .component-example-button--primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .component-example-button--primary:hover:not(.component-example-button--disabled) {
      background: linear-gradient(135deg, #5568d3 0%, #653a8b 100%);
    }

    .component-example-button--secondary {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
    }

    .component-example-button--secondary:hover:not(.component-example-button--disabled) {
      background: linear-gradient(135deg, #e082ea 0%, #e44655 100%);
    }

    .component-example-button--danger {
      background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
      color: #333;
    }

    .component-example-button--danger:hover:not(.component-example-button--disabled) {
      background: linear-gradient(135deg, #e95f89 0%, #edd02f 100%);
    }

    .component-example-button--disabled {
      background: #e0e0e0 !important;
      color: #999 !important;
      cursor: not-allowed;
      opacity: 0.6;
    }

    .component-example-button__label {
      flex: 1;
      text-align: center;
    }

    .component-example-button__count {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 24px;
      height: 24px;
      padding: 0 6px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 12px;
      font-size: 12px;
      font-weight: 700;
      backdrop-filter: blur(4px);
    }

    .component-example-button--danger .component-example-button__count {
      background: rgba(0, 0, 0, 0.15);
    }

    .component-example-button--disabled .component-example-button__count {
      background: rgba(0, 0, 0, 0.1);
    }
  </style>
</head>
<body>
  <div class="sandbox-container">
    <div class="sandbox-header">
      <div class="sandbox-title">Example Button - Sandbox Test</div>
      <div class="sandbox-subtitle">Demonstrating quality-first workflow: Contract → Test → Code → Sandbox → Proven</div>
      <div class="sandbox-status" id="status">Status: Initializing...</div>
    </div>

    <!-- Component renders here -->
    <div id="component-mount"></div>

    <div class="test-controls">
      <button onclick="runTest()">Run Full Test</button>
      <button onclick="clearLogs()">Clear Logs</button>
      <button onclick="resetComponent()">Reset Component</button>
      <button onclick="testVariants()">Test All Variants</button>
      <button onclick="testPerformance()">Performance Test</button>
    </div>

    <div class="test-log" id="testLog"></div>
  </div>

  <!-- Component script -->
  <script>
    class ExampleButton {
      constructor(config) {
        if (!config.label) {
          throw new Error('label is required');
        }
        if (!config.containerId) {
          throw new Error('containerId is required');
        }

        this.label = config.label;
        this.containerId = config.containerId;
        this.onClick = config.onClick || (() => {});
        this.variant = ['primary', 'secondary', 'danger'].includes(config.variant)
          ? config.variant
          : 'primary';
        this.disabled = config.disabled || false;

        this.clickCount = 0;
        this.element = null;
        this.countElement = null;

        this.render();
      }

      render() {
        const container = document.getElementById(this.containerId);
        if (!container) {
          throw new Error(`Container with id '${this.containerId}' not found`);
        }

        this.element = document.createElement('button');
        this.element.className = `component-example-button component-example-button--${this.variant}`;

        if (this.disabled) {
          this.element.className += ' component-example-button--disabled';
          this.element.disabled = true;
        }

        const labelSpan = document.createElement('span');
        labelSpan.className = 'component-example-button__label';
        labelSpan.textContent = this.label;

        this.countElement = document.createElement('span');
        this.countElement.className = 'component-example-button__count';
        this.countElement.textContent = '0';

        this.element.appendChild(labelSpan);
        this.element.appendChild(this.countElement);

        this.handleClick = this.handleClick.bind(this);
        this.element.addEventListener('click', this.handleClick);

        container.appendChild(this.element);
      }

      handleClick() {
        if (!this.disabled) {
          this.clickCount++;
          this.updateCount();
          this.onClick(this.clickCount);
        }
      }

      updateCount() {
        if (this.countElement) {
          this.countElement.textContent = this.clickCount.toString();
        }
      }

      getCount() {
        return this.clickCount;
      }

      reset() {
        this.clickCount = 0;
        this.updateCount();
      }

      destroy() {
        if (this.element) {
          this.element.removeEventListener('click', this.handleClick);
          this.element.remove();
          this.element = null;
          this.countElement = null;
        }
      }
    }
  </script>

  <script>
    // Test harness
    const testLog = document.getElementById('testLog');
    const status = document.getElementById('status');
    let buttons = [];

    function log(message, type = 'info') {
      const entry = document.createElement('div');
      entry.className = 'test-log-entry';
      const time = new Date().toLocaleTimeString();
      const colorClass = type === 'success' ? 'test-log-success' : type === 'error' ? 'test-log-error' : 'test-log-info';
      entry.innerHTML = `<span class="test-log-time">[${time}]</span> <span class="${colorClass}">${message}</span>`;
      testLog.appendChild(entry);
      testLog.scrollTop = testLog.scrollHeight;
    }

    function updateStatus(msg) {
      status.textContent = `Status: ${msg}`;
    }

    function clearLogs() {
      testLog.innerHTML = '';
      log('Logs cleared', 'info');
    }

    function resetComponent() {
      buttons.forEach(btn => btn.destroy());
      buttons = [];
      document.getElementById('component-mount').innerHTML = '';
      log('All components destroyed', 'info');
      updateStatus('Ready for test');
    }

    function runTest() {
      try {
        resetComponent();
        log('Starting comprehensive test...', 'info');
        updateStatus('Running test...');

        // Test 1: Basic initialization
        log('Test 1: Basic initialization', 'info');
        const btn1 = new ExampleButton({
          label: 'Click Me',
          containerId: 'component-mount'
        });
        buttons.push(btn1);
        log('✅ Component initialized', 'success');

        // Test 2: Click handling
        log('Test 2: Click handling', 'info');
        const initialCount = btn1.getCount();
        if (initialCount !== 0) throw new Error('Initial count should be 0');
        log('✅ Initial count is 0', 'success');

        // Test 3: Callback execution
        log('Test 3: Callback with onClick', 'info');
        let callbackFired = false;
        let callbackCount = 0;
        const btn2 = new ExampleButton({
          label: 'Test Callback',
          containerId: 'component-mount',
          onClick: (count) => {
            callbackFired = true;
            callbackCount = count;
          }
        });
        buttons.push(btn2);
        btn2.element.click();
        if (!callbackFired) throw new Error('Callback should fire');
        if (callbackCount !== 1) throw new Error('Callback should receive count');
        log('✅ onClick callback working', 'success');

        // Test 4: Reset functionality
        log('Test 4: Reset functionality', 'info');
        btn2.reset();
        if (btn2.getCount() !== 0) throw new Error('Reset should set count to 0');
        log('✅ Reset working', 'success');

        // Test 5: CSS namespacing
        log('Test 5: CSS namespace verification', 'info');
        const hasNamespace = btn1.element.className.includes('component-example-button');
        if (!hasNamespace) throw new Error('Missing proper namespace');
        const hasNoGlobalClasses = !btn1.element.className.match(/\b(btn|button)\b/);
        if (!hasNoGlobalClasses) throw new Error('Using reserved global classes');
        log('✅ CSS properly namespaced', 'success');

        // Test 6: DOM structure
        log('Test 6: DOM structure', 'info');
        if (btn1.element.children.length !== 2) throw new Error('Should have 2 children');
        log('✅ DOM structure correct', 'success');

        // Test 7: Performance
        log('Test 7: Performance check', 'info');
        const start = performance.now();
        for (let i = 0; i < 100; i++) {
          btn1.element.click();
        }
        const duration = performance.now() - start;
        log(`✅ 100 clicks in ${duration.toFixed(2)}ms`, 'success');

        log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━', 'success');
        log('✅ ALL TESTS PASSED', 'success');
        log('Component is proven and ready for integration', 'success');
        updateStatus('Test PASSED ✅');

      } catch (error) {
        log(`❌ Error: ${error.message}`, 'error');
        updateStatus('Test FAILED ❌');
      }
    }

    function testVariants() {
      try {
        resetComponent();
        log('Testing all button variants...', 'info');

        const variants = [
          { variant: 'primary', label: 'Primary Button' },
          { variant: 'secondary', label: 'Secondary Button' },
          { variant: 'danger', label: 'Danger Button' },
          { variant: 'primary', label: 'Disabled Button', disabled: true }
        ];

        variants.forEach(config => {
          const btn = new ExampleButton({
            ...config,
            containerId: 'component-mount',
            onClick: (count) => log(`${config.label} clicked: ${count}`, 'info')
          });
          buttons.push(btn);
        });

        log('✅ All variants rendered successfully', 'success');
        updateStatus('Variants ready - click buttons to test');
      } catch (error) {
        log(`❌ Error: ${error.message}`, 'error');
        updateStatus('Variant test FAILED');
      }
    }

    function testPerformance() {
      try {
        resetComponent();
        log('Running performance test...', 'info');
        updateStatus('Performance testing...');

        const btn = new ExampleButton({
          label: 'Performance Test',
          containerId: 'component-mount'
        });
        buttons.push(btn);

        // Test 1000 clicks
        const start = performance.now();
        for (let i = 0; i < 1000; i++) {
          btn.element.click();
        }
        const duration = performance.now() - start;

        log(`✅ 1000 clicks in ${duration.toFixed(2)}ms`, 'success');
        log(`✅ Average: ${(duration / 1000).toFixed(3)}ms per click`, 'success');

        if (duration < 100) {
          log('✅ EXCELLENT performance (<100ms)', 'success');
        } else if (duration < 500) {
          log('✅ GOOD performance (<500ms)', 'success');
        } else {
          log('⚠️ Performance needs optimization (>500ms)', 'error');
        }

        updateStatus('Performance test complete');
      } catch (error) {
        log(`❌ Error: ${error.message}`, 'error');
        updateStatus('Performance test FAILED');
      }
    }

    // Auto-run on load
    window.addEventListener('load', () => {
      updateStatus('Ready for testing');
      log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━', 'info');
      log('Example Button - Sandbox Test Environment', 'info');
      log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━', 'info');
      log('Sandbox initialized', 'success');
      log('Component loaded', 'success');
      log('Click "Run Full Test" to execute automated tests', 'info');
      log('Click "Test All Variants" to see visual variants', 'info');
      log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━', 'info');
    });
  </script>
</body>
</html>
